<!-- Header -->
<nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <a class="navbar-brand" href="/home/index">Brand</a>
    <ul class="nav navbar-nav nav-icons">
      <li><a href="/home/profile"><i class="fa fa-user fa-2x" aria-hidden="true"></i><span class="sr-only">(current)</span></a></li>
      <li><a href="/home/my_friends"><i class="fa fa-users fa-2x" aria-hidden="true"></i></a></li>
      <li><a href="/rooms/show"><i class="fa fa-comments-o fa-2x" aria-hidden="true"></i></a></li>
      <li><a href="/users/edit"><i class="fa fa-cog fa-2x" aria-hidden="true"></i></a></li>
      <li><a href="/users/sign_out"><i class="fa fa-sign-out fa-2x" aria-hidden="true"></i></a></li>
    </ul>
  </div>
</nav>
<br><br><br><br>

<div class="sidebar">
  <p class="sidebar-group-logo">Group Logo</p>
  <ul class="menus">
    <li><a id="ann_slide" href="#announcement" data-value="<%= @group.id %>">Annoucement</a>  <span id="ann_badge" class="badge"><%= @current_groupuser.ann_notification %></span></li>
    <li><a id="cal_slide" href="#calendar" data-value="<%= @group.id %>">Calendar</a>         <span id="cal_badge" class="badge"><%= @current_groupuser.cal_notification %></span></li>
    <li><a id="budget_slide" href="#budget" data-value="<%= @group.id %>">Budget Tracker</a>  <span id="budget_badge" class="badge"><%= @current_groupuser.budget_notification %></span></li>
    <li><a id="poll_slide" href="#poll" data-value="<%= @group.id %>">Poll</a>                <span id="poll_badge" class="badge"><%= @current_groupuser.poll_notification %></span></li>
    <li><a href="#contact">Contact Us</a></li>
  </ul>
</div>

<div class ="container" id="container-group-page">
  <h1><%= @group.name %></h1>
  <ul class ="nav nav-pills nav-justified">
    <li class="active"><a href="#Home" data-toggle="tab">Home</a></li>
    <li><a href="#Network" data-toggle="tab">Member</a></li>
  </ul>

  <div></div>

  <div class="tab-content">
    <div class="tab-pane fade in active" id="Home">
        <!-- Announcements -->
        <h1 style="padding-top: 60px;"><a name="announcement">Announcement</a></h1>
      <div id="announcement_carousel" data-wrap="true"  class="carousel slide" data-interval="false" data-ride="carousel">
       <ol class="carousel-indicators">
         <li data-target="#announcement_carousel" data-slide-to="0" class="active"></li>
          <% @recent_announc.each do |a| %>
            <li data-target="#announcement_carousel" data-slide-to="i"></li>
          <% end %>
       </ol>
       <div class="carousel-inner">
         <div class="item active">
             <center><img class="img-responsive" align="middle" src="http://hdwallpaperbackgrounds.net/wp-content/uploads/2016/08/black-background-49.jpg" width="700" height="0" /></center>
             <div class="carousel-caption">
                  Your Group's Announcements
             </div>
           </div>
          <% @recent_announc.each do |a| %>
            <div class="item">
              <center><img class="img-responsive" align="middle" src="http://hdwallpaperbackgrounds.net/wp-content/uploads/2016/08/black-background-49.jpg" width="700" height="400"/></center>
                <div class="carousel-caption">
                <%= a.created_at %><br>
                <%= a.title %><br>
                <%= a.content %>
                </div>
            </div>
          <% end %>


      </div>

        <a href="#announcement_carousel" class="carousel-control left" data-slide="prev">
          <span class="glyphicon glyphicon-chevron-left"></span>
        </a>
        <a href="#announcement_carousel" class="carousel-control right" data-slide="next">
          <span class="glyphicon glyphicon-chevron-right"></span>
        </a>
      </div>
      <!-- Make an announcement -->
      <div>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#post_announc">New</button>
          <div class="modal fade" id="post_announc" tableindex="-1" role="dialog">
           <div class="modal-dialog" role="document">
             <div class="modal-content">
               <div class="modal-header">
                 <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                   <span aria-hidden="true">&times;</span>
                 </button>
                 <h5 class="modal-title">Post New Announcement</h5>
               </div>
               <div class="modal-body">
                 <form action="/home/announcement" method="get">
                  <input name="announc_title" type="text"/>
                  <textarea name="announc_content" type="text"></textarea>
                  <button name="group_id" value= "<%= @group.id %>" type="submit" class="btn btn-default">Post</button>
                 </form>
               </div>
             </div>
           </div>
         </div>
      </div>
      <!-- View all announcements -->
      <form action="/home/announcement_all" method="get">
        <input name= "group_id" type="hidden" value= "<%= @group.id %>"/>
        <button type="submit" class="btn btn-default">View All Announcements</button>
      </form>

      <!-- Calendar -->
      <h1 style="padding-top: 60px;"><a name="calendar">Calendar</a></h1>
      <div class="calendar">
        <input name= "group_id" type="hidden" value= "<%= @group.id %>">
      </div>

      <!-- Budget Tracker -->
      <h1 style="padding-top: 60px;"><a name="budget">Budget Tracker</a></h1>
        <!-- Money Gained -->
        <input id= "money" type="number" class="form-control" placeholder="$00.00">
        <input id= "description" type="text" class="form-control" placeholder="Description">
        <button value = "<%= @group.id %>" type="submit" class="btn btn-default money_plus_button">Plus</button>
        <button value = "<%= @group.id %>" type="submit" class="btn btn-default money_minus_button">Minus</button>


      <!-- Add div to let the ajax script know where to append new input field. -->
      <div id="transactions">
        <!-- Find Current Group's Budget -->
        <% Budget.where(group_id: @group.id).find do |b| %>
        <!-- Transaction records for that budget -->
          <% Transaction.where(budget_id: b.id).find_each do |t| %>
          <!-- If the transaction is revenue -->
            <% if t.pos_neg == true %>
              <p style="color: green"><%= t.value %></p>
              <p><%= t.description %></p>
            <% end %>
            <!-- If the transaction is debt -->
            <% if t.pos_neg == false %>
              <p style="color: red"><%= t.value %></p>
              <p><%= t.description %></p>
            <% end %>
          <% end %>
          <!-- Budget Balance -->
            <h3> <%= b.group_budget %> </h3>
        <% end %>
      </div>

      <!-- Black Board -->
      <h1 style="padding-top: 60px;"><a name="poll">Black Board</a></h1>
     <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#create_poll">Create Poll</button>
       <div class="modal fade" id="create_poll" tableindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
              <h5 class="modal-title">Create New Poll</h5>
            </div>
            <div class="modal-body">
             <form id = "form_poll" action="/home/new_poll" method="get">
             <input name="poll_title" type="text" class="input-box_text" placeholder="Title"/><br>
             <!-- Add div to let the ajax script know where to append new input field. -->
               <div id = "option_div">
               <!-- 2 options default-->
                 <% for i in 1..2 %>
                   <input name="option_content_<%= i %>" id="option_<%= i %>"type="text" class="input-box_text" placeholder="Option <%= i %>"/><br>

                 <% end %>
               </div>

               <!--Closing Time, Calls datetimepicker in script-->
               <div class="container">
                  <div class="row">
                      <div class='col-sm-6'>
                          <div class="form-group">
                              <div class='input-group date' id='datetimepicker1'>
                                  <input type='text' class="form-control" />
                                  <span class="input-group-addon">
                                      <span class="glyphicon glyphicon-calendar"></span>
                                  </span>
                              </div>
                          </div>
                      </div>
                      <script type="text/javascript">
                          $(function () {
                              $('#datetimepicker1').datetimepicker();
                          });
                      </script>
                  </div>
              </div>
               <!--anonymous checkbox-->
               <div class="checkbox">
                 <label><input name=anonymous type="checkbox" value="true">Anonymous?</label>
               </div>
               <button name="group_id" value="<%= @group.id %>" type="submit" class="btn btn-default">Create!</button>
             </form>
             <!--Add an Option, Used Ajax. Look at script-->
             <button value= "<%= $n %>" type="submit" class="btn btn-default add_option">Add an Option</button>
            </div>
          </div>
       </div>
     </div>


       <!-- Polls -->
       <% @poll.each do |p| %>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#poll_<%= p.id %>"><%= p.title %></button>
        <!-- Create one Modal for each poll-->
        <div class="modal fade" id="poll_<%= p.id %>" tableindex="-1" role="dialog">
         <div class="modal-dialog" role="document">
           <div class="modal-content">
             <div class="modal-header">
               <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                 <span aria-hidden="true">&times;</span>
               </button>
               <h5 class="modal-title"><%= p.title %></h5>
             </div>
             <div class="modal-body">
               <ul class ="nav nav-pills nav-justified">
                 <li class="active"><a href="#one_poll_<%= p.id %>" data-toggle="tab">Poll</a></li>
                 <li><a href="#Votes_<%= p.id %>" data-toggle="tab">Votes</a></li>
               </ul>
               <div class="tab-content">
                 <div class="tab-pane fade in active" id="one_poll_<%= p.id %>">
                   <!-- If user already voted -->
                   <% if Polluser.where(user_id: @user.id).where(poll_id: p.id).where(voted: true).exists? %>
                     <form action="/home/option_cancel" method="get">
                     <% Option.where(poll_id: p.id).find_each do |o| %>
                      <div class="radio">
                        <label><input type="radio" name="optradio" value="<%= o.id %>"><%= o.content %></label> <strong><%= o.vote_number %></strong>
                      </div>
                     <% end %>
                     <!-- user cancels his/her vote -->
                     <button name="poll_id" value="<%= p.id %>" type="submit" class="btn btn-default">Cancel My Vote</button>
                     </form>
                     <form action="/home/delete_poll" method="get">
                       <button name="poll_id" value="<%= p.id %>" type="submit" class="btn btn-default">Close Poll</button>
                     </form>
                   <% else %>
                   <!-- If user has not voted or canceled -->
                     <form action="/home/option_select" method="get">
                       <% Option.where(poll_id: p.id).find_each do |o| %>
                        <div class="radio">
                          <label><input type="radio" name="optradio" value="<%= o.id %>"><%= o.content %></label> <strong><%= o.vote_number %></strong>
                        </div>
                       <% end %>
                       <button name="poll_id" value="<%= p.id %>"type="submit" class="btn btn-default">Vote!</button>
                     </form>
                     <form action="/home/delete_poll" method="get">
                       <button name="poll_id" value="<%= p.id %>" type="submit" class="btn btn-default">Close Poll</button>
                     </form>
                   <% end %>
                 </div>
                 <div class="tab-pane fade in" id="Votes_<%= p.id %>">
                   <!-- Anonymous? -->
                   <% if p.anonymous == nil %>
                   <!-- if not, then find Options in this poll -->
                  <% Option.where(poll_id: p.id).find_each do |o| %>
                    <strong><%= o.content %></strong> <br>
                    <!-- Find the people who voted -->
                    <% Polluser.where(option_id: o.id).where(voted: true).find_each do |pu| %>
                      <% User.where(id: pu.user_id).find_each do |voted_user| %>
                        <%= voted_user.first_name %> <%= voted_user.last_name %>
                      <% end %>
                      <br>
                    <% end %>
                    <% end %>
                    <strong><p>Not Voted</p></strong>
                    <% GroupUser.where(group_id: @group.id).find_each do |gr| %>
                      <% User.where(id: gr.user_id).find_each do |not_voted_user| %>
                        <% if !Polluser.where(user_id: not_voted_user.id).where(poll_id: p.id).exists? %>
                          <%= not_voted_user.first_name %> <%= not_voted_user.last_name %>
                        <% end %>
                        <% if Polluser.where(user_id: not_voted_user.id).where(poll_id: p.id).where(voted: false).exists? %>
                          <%= not_voted_user.first_name %> <%= not_voted_user.last_name %>
                        <% end %>
                      <% end %>
                    <% end %>
                    <% else %>
                    <p>Anonymous</p>
                    <% end %>
                 </div>
               </div>
             </div>
           </div>
         </div>
       </div>
       <% end %>
    </div>
    
    <div class="tab-pane fade in" id="Network">
      <!-- Friend List + Friend Requests -->
      <% GroupUser.where(group_id: @group.id).where.not(user_id: @user.id).find_each do |friends| %>
      <% User.where(id: friends.user_id).find_each do |friends_info| %>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#user_profile_<%= friends_info.id %>"><%= friends_info.first_name %> <%= friends_info.last_name %></button>
          <div class="modal fade" id="user_profile_<%= friends_info.id %>" tableindex="-1" role="dialog">
           <div class="modal-dialog" role="document">
             <div class="modal-content">
               <div class="modal-header">
                 <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                   <span aria-hidden="true">&times;</span>
                 </button>
                 <h5 class="modal-title"><%= friends_info.first_name %>'s profile</h5>
               </div>
               <div class="modal-body">
                <ul class="list-group">
                  <li class="list-group-item">Name: <%= friends_info.first_name %> <%= friends_info.last_name %></li>
                  <li class="list-group-item">Email: <%= friends_info.email %></li>
                  <li class="list-group-item">School: <%= friends_info.school %></li>
                  <li class="list-group-item">Major: <%= friends_info.major %></li>
                  <li class="list-group-item">Class of Year: <%= friends_info.class_year %></li>
                  <li class="list-group-item">Company: <%= friends_info.company %> </li>
                </ul>
               </div>
               <div class="modal-footer">
                 <div class="input-box">
                   <input type="text" class="input-box_text" id="message_input"/>
                 </div>
                 <form action="/rooms/new_chat" method="get">
                  <input name= "group_id" type="hidden" value= "<%= @group.id %>">
                  <button name="friend_id" value= "<%= friends_info.id %>" type="submit" class="btn btn-default reply_submit">Submit</button>
                </form>
               </div>
             </div>
           </div>
         </div>
         <br>
      <% end %>
      <% end %>
    </div>
  </div>
</div>

<script>
  //Budget - plus
  $(function() {
    $('.money_plus_button').click(function(){

      group_id = this.value;
      money_plus = $('#money').val();
      description_p = $('#description').val();

      $.ajax({
        method: "POST",
        url: '/home/money_plus',
        data: { group_id: group_id,
                money_plus: money_plus,
                description_p: description_p }

      }).done(function() {
        $("#transactions").append("<p style = \"color: green\">" + money_plus + "</p>");
        $("#transactions").append("<p>" + description_p + "</p>");
      });

    });
  });
//Budget - minus
  $(function() {
    $('.money_minus_button').click(function(){

      group_id = this.value;
      money_minus = $('#money').val();
      description_m = $('#description').val();

      $.ajax({
        method: "POST",
        url: '/home/money_minus',
        data: { group_id: group_id,
                money_minus: money_minus,
                description_m: description_m }

      }).done(function() {
        $("#transactions").append("<p style = \"color: red\">" + money_minus + "</p>");
        $("#transactions").append("<p>" + description_m + "</p>");
      });
    });
  });

// Poll - add option
var i = 1;
$(function() {
    $(".add_option").click(function(){
     n = parseInt(this.value);// to use the value of '$n'
     n = n + i;
     i = i + 1;
      $.ajax({
        method: "get",
        url: "/home/add_option",

        success: function(){

          $("#option_div").append("<input name=\"option_content_"
                                  + n + "\" id=\"option_" + n + "\"type=\"text\" class=\"input-box_text\" placeholder=\"Option "
                                  + n + "\"/><br>");
        },
        error: function(){
          alert("ERROR!");
        }
      })
    });
});


//Announcement notification read
  $(function() {
    $('#ann_slide').click(function(){
      group_id = parseInt($(this).data("value"));

      $.ajax({
        method: "POST",
        url: "/home/ann_read",
        data: { group_id: group_id}

      }).done(function() {
        document.getElementById("ann_badge").innerHTML = "0";
      });

    });
  });

//Budget notification read
  $(function() {
    $('#budget_slide').click(function(){
      group_id = parseInt($(this).data("value"));

      $.ajax({
        method: "POST",
        url: "/home/budget_read",
        data: { group_id: group_id}

      }).done(function() {
        document.getElementById("budget_badge").innerHTML = "0";
      });

    });
  });

//Poll notification read
  $(function() {
    $('#poll_slide').click(function(){
      group_id = parseInt($(this).data("value"));

      $.ajax({
        method: "POST",
        url: "/home/poll_read",
        data: { group_id: group_id}

      }).done(function() {

      });

    });
  });
</script>
